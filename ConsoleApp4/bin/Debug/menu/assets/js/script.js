//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@###########@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#SS%%%???????????????%%%SS#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@@@@@@@@@@@@@#S%%???%%%%%%%%%%%%%%????????????%S#@@@@@@@@@@@@@@@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@@@@@@@@@@#%%%%SSSSSSSSS%%%SSSSSSSSSSS%%??????????%S@@@@@@@@@@@@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@@@@@@@#S%SSSS%%%???????????????????%%SSSSS%?????????S#@@@@@@@@@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@@@@#SSSSS%%????????????%%%SSSSSSSSS%%%??%%SSS%????????%#@#@@@@@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@@#SSSS%??????????%SS#@@@@@@@@@@@@@@@@@@@#S%%%SS%%???????%SSS@@@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@#SS%?????????%S#@@@@@@@@@@@@@@@@@@@@@@##@@@@##S%SS%???????SS%S@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@S %????????%#@@@@@@@@@@@@@@#@@@@@#S@@@S?%@@@@@@@@#SSS%??????%#%%#@@@@@@@@@@
//@@@@@@@@@@@@@S %???????%S@@@@@@@@@@@@@@@SS#@#SSS#@#S??%@@@@@@@@@@@###%???????SS?S@@@@@@@@@
//@@@@@@@@@@@@%???????%SS#@@@@@@@@@@@@#%%%SSSSS#SS%?%S#@@@@@@@@@@@@@@@@#???????#S?S@@@@@@@@@
//@@@@@@@@@@#???????%SSS#@@@@@@@@@@@#S???%??%%%%%S##@@@#SS%%%S@@@@@@@@@@#%??????#%?%@@@@@@@@
//@@@@@@@@@S ???????SS%S@@@@@@@@@@@@S???????%%S###SSSS%????%%SSSSSSSS#@@@@@%?????%#??%@@@@@@
//@@@@@@@@S ??????%SS?S@@@@@@@@@@#S???????%S#SS%???%??????????????%%S##@@@@@%?????SS??S@@@@@
//@@@@@@@#??????%#%?S@@@@@@@@@S%?????????S@S%%???????????????????%%SS#@@@@@#?????%#???#@@@@@
//@@@@@@@%?????%#%?S@@@@@@@#%???%%???????%%%%SS%?????????????????????%%S@@@@S?????#%??%@@@@@
//@@@@@@S ?????%#%?%@@@@@@@#???%@S%????????%%SS#@%???????????????????%S###@@@@?????SS???#@@@
//@@@@@@%?????#%??S@@@@#S%????%%???????%SSSSSS#@@##SS%%???????????????%#@@@@@S????#S???%@@@@
//@@@@@@?????SS???@@S%???????%%S###%??%S%?%SS#@@@@@@@@@@S%??????????????%@@@@#????#S???%@@@@
//@@@@@@?????#%???@S????%%%S#@@@@@@%??????%#@@@@@@@@@@@@@@#%?????????????%@@@#????S%????#@@@
//@@@@@@????%#????@#%%##@@@@@@@@@@#???%%%#@@@@@@@@@@@@@@@@@@%??????????%#%%@@#???%#%????@@@@
//@@@@@@????SS????@@@@@@@@@@@@@@@#%?%#@@@@@@@@@@@@@@@@@@@@@@@%??????????#@#@@#???SS?????@@@@
//@@@@@@????S%????#@@@@@@@@@@##%???%@@@@@@@@@@@@@@@@@@@@@@@@@#??????????S@@@@S??%#%????%@@@@
//@@@@@@%???S%????S@@@@@@@@@@#%???S@@@@@@@@@@@@@@@@@@@@@@@@@@#??????????S@@@@%??SS?????S@@@@
//@@@@@@S ???S%????%@@@@@@@@@@@@##@@@@@@@@@@@@@@@@@@@@@@@@@@@@#??????????#@@@S??SS?????%@@@@
//@@@@@@@%??SS?????S@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@S??????%%?S@@@@%?SS??????S@@@@@
//@@@@@@@S ??%#??????#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#%?????S@@#@@@@%?SS??????%@@@@@
//@@@@@@@@%??SS?????%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%????%#@@@@@@@%%S%??????%@@@@@@@
//@@@@@@@@@%?%#%?????%#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#%???%S@@@@@@@#%%S%??????%@@@@@@@@
//@@@@@@@@@@%?%S??????%#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@S???%#@@@@@@@@S%S%???????S@@@@@@@@@
//@@@@@@@@@@@S? SS???????S@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#S??%S@@@@@@@@@@SS%???????%#@@@@@@@@@
//@@@@@@@@@@@@S?SS???????%###@@@@@@@@@@@@@@@@@@@@@@@#SSS#@@@@@@@@@@@@S%????????S@@@@@@@@@@@@
//@@@@@@@@@@@@@#%%S%???????%SSS#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#%%????????%S@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@S%SS????????%SSSS#@@@@@@@@@@@@@@@@@@@@@@@@@@@#S%?????????%SSS#@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@@@SSS%????????%SSS%%%S#@@@@@@@@@@@@@@@@##S%%??????????%SSSS#@@@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@@@@@###%????????%%SSS%%??%%%%%%%%%%%%%????????????%%SS%%S#@@@@@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@@@@@@@@@#S%?????????%%SSSS%%%??????????????%%%%SSSS%%%S@@@@@@@@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@@@@@@@@@@@@#S%??????????%%%SSSSSSSSSSSSSSSSSS%%%??%S@@@@@@@@@@@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#S%%????????????????%%%????????%%S#@@@@@@@@@@@@@@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#SS%%?????????????%%%SS##@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@########@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ 



document.addEventListener("DOMContentLoaded", () => {
  const toggle = document.getElementById("theme-toggle");
  const themeToggle = document.getElementById('theme-toggle');
  const icon = themeToggle.querySelector('svg');
  const body = document.body;

  // Charger le thème sauvegardé
  const savedTheme = localStorage.getItem("theme");
  if (savedTheme === "light") {
    body.classList.add("light-theme");
    icon.classList.toggle('active');
  }

  // Inverser le thème au clic
  toggle.addEventListener("click", () => {
    body.classList.toggle("light-theme");

    // Sauvegarder
    if (body.classList.contains("light-theme")) {
      localStorage.setItem("theme", "light");
    } else {
      localStorage.setItem("theme", "dark");
    }
  });
});




window.addEventListener('load', () => {
  setTimeout(() => {
    const intro = document.getElementById('intro-overlay');
    if (intro) intro.remove();
  }, 4000); // after animation completes
});


const tabs = document.querySelectorAll('.tab-button');
const contents = document.querySelectorAll('.tab-content');

tabs.forEach(tab => {
  tab.addEventListener('click', () => {
    const target = tab.dataset.tab;

    tabs.forEach(btn => btn.classList.remove('active'));
    tab.classList.add('active');

    contents.forEach(content => content.classList.add('hidden'));
    document.getElementById(target).classList.remove('hidden');
  });
});

// Example dynamic values
document.getElementById("pc-name").textContent = navigator.platform;
document.getElementById("expiry").textContent = "31/12/2025";



async function loadIniData() {
  try {
    const response = await fetch('/configdata');  // Endpoint à définir
    if (!response.ok) throw new Error('Erreur lors du chargement des données INI');
    const iniData = await response.json();

    for (const [key, value] of Object.entries(iniData)) {
      if (!(key in map)) continue;

      const [type, selector, index] = map[key];
      const inputs = document.querySelectorAll(selector);
      const input = inputs[index];
      if (!input) continue;

      if (type === "checkbox") {
        input.checked = value.toLowerCase() === "true";
      } else {
        input.value = value;
      }
    }
  } catch (err) {
    console.error(err);
  }
}

function sendIniUpdate(key, value) {
  fetch('/updateconfig', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ key, value })
  }).then(res => {
    if (!res.ok) {
      console.error("Échec de la mise à jour INI pour", key);
    }
  });
}

function bindInputsToIniUpdates(dataMap) {
  for (const [key, value] of Object.entries(dataMap)) {
    const [type, selector, index] = value;
    const inputs = document.querySelectorAll(selector);
    const input = inputs[index];
    if (!input) continue;

    const handler = () => {
      let val;
      if (type === "checkbox") val = input.checked.toString();
      else val = input.value.toString();
      sendIniUpdate(key, val);
    };

    input.addEventListener("change", handler);
    input.addEventListener("input", handler);
  }
}

const map = {
  // [AIMBOT]
  "Enable_AIMBOT": ["checkbox", "#aimbot input[type='checkbox']", 0],
  "Aim_FOV": ["range", "#aimbot input[type='range']", 0],
  "Draw_Aim_Fov": ["checkbox", "#aimbot input[type='checkbox']", 2],
  "Draw_Enemy_Close": ["checkbox", "#aimbot input[type='checkbox']", 3],
  "Aim_Filter": ["select", "#aimbot select", 0],
  "Aim_Target": ["select", "#aimbot select", 1],
  "AIM_Key": ["text", "#aimbot input[type='text']", 0],
  "Auto_Fire": ["checkbox", "#aimbot input[type='checkbox']", 1],
  "Auto_Fire_MS": ["range", "#aimbot input[type='range']", 1],

  // [ESP]
  "Enable_ESP": ["checkbox", "#esp input[type='checkbox']", 0],
  "ESP_Form": ["select", "#esp select", 0],
  "ESP_Size": ["range", "#esp input[type='range']", 0],
  "ESP_Max_Distance": ["range", "#esp input[type='range']", 1],
  "Show_Allies": ["checkbox", "#esp input[type='checkbox']", 1],
  "Show_Character_Name": ["checkbox", "#esp input[type='checkbox']", 2],
  "Show_Distance": ["checkbox", "#esp input[type='checkbox']", 3],
  "Show_Ping": ["checkbox", "#esp input[type='checkbox']", 4],
  "Enable_Snapline": ["checkbox", "#esp input[type='checkbox']", 5],
  "Snapline_Size": ["range", "#esp input[type='range']", 2],
  "Snapline_Starting_Point": ["select", "#esp select", 1],

  // [MISC]
  "Enable_CROSSHAIR": ["checkbox", "#misc input[type='checkbox']", 0],
  "Enable_VSAT": ["checkbox", "#misc input[type='checkbox']", 3],
  "Crosshair_Size": ["range", "#misc input[type='range']", 0],
  "Crosshair_Thickness": ["range", "#misc input[type='range']", 1],
  "Show_Text_Border": ["checkbox", "#misc input[type='checkbox']", 1],
  "Text_Size": ["range", "#misc input[type='range']", 2],
  "Font_Text": ["text", "#misc input[type='text']", 0],
  "Transparency": ["checkbox", "#misc input[type='checkbox']", 2],

  // [STYLES]
  "Enemies_Color": ["color", "#styles input[type='color']", 0],
  "Allies_Color": ["color", "#styles input[type='color']", 1],
  "Filled_Border_Color": ["color", "#styles input[type='color']", 2],
  "Snapline_Color": ["color", "#styles input[type='color']", 3],
  "Crosshair_Color": ["color", "#styles input[type='color']", 4],
  "FOV_Color": ["color", "#styles input[type='color']", 5],
  "Menu_Color": ["color", "#styles input[type='color']", 6],
  "Player_Name_Color": ["color", "#styles input[type='color']", 7],
  "Player_Ping_Color": ["color", "#styles input[type='color']", 8],
  "Background": ["color", "#styles input[type='color']", 9],

  // [SETTINGS]
  "Show_FPS": ["checkbox", "#settings input[type='checkbox']", 1],
  "VSYNC": ["checkbox", "#settings input[type='checkbox']", 2],
  "FPS": ["number", "#settings input[type='number']", 0],
  "FPS_Corner": ["select", "#settings select", 0],
  "Show_Menu": ["text", "#settings input[type='text']", 0],
  "Show_Overlay": ["checkbox", "#settings input[type='checkbox']", 0],
  "Menu_Opacity": ["range", "#settings input[type='range']", 0],
  "Anti_Aliasing": ["checkbox", "#settings input[type='checkbox']", 3],
  "GameWidth": ["number", "#settings input[type='number']", 1],
  "GameHeight": ["number", "#settings input[type='number']", 2],
};

// WebSocket setup
let socket;

function initWebSocket() {
  const protocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
  const wsUrl = `${protocol}//${location.host}/`;

  socket = new WebSocket(wsUrl);

  socket.addEventListener('open', () => {
    console.log("WebSocket connected");
  });

  socket.addEventListener('message', async (event) => {
    try {
      const data = JSON.parse(event.data);
      if (data.type === "configUpdated") {
        console.log("Config mise à jour reçue via WebSocket, rechargement...");
        await loadIniData();
      }
    } catch (err) {
      console.error("Erreur lors du traitement du message WebSocket :", err);
    }
  });

  socket.addEventListener('close', () => {
    console.log("WebSocket fermé, tentative de reconnexion dans 3s...");
    setTimeout(initWebSocket, 3000); // Reconnect après 3s
  });

  socket.addEventListener('error', (err) => {
    console.error("Erreur WebSocket :", err);
    socket.close();
  });
}

window.addEventListener('DOMContentLoaded', () => {
  loadIniData().then(() => {
    bindInputsToIniUpdates(map);
  });

  initWebSocket();
});




const icon = document.querySelector('.icon-right');
const menu = document.querySelector('.menu');
const explosionContainer = document.getElementById('explosion-container');
let isAnimating = false;

icon.addEventListener('click', () => {
  if (isAnimating) return;
  isAnimating = true;

  icon.classList.add('animate');
  menu.classList.add('shake');

  // Optional sound (you’ll add manually)
  const sound = new Audio('assets/sounds/boom.mp3');
  sound.play();

  // Cool particle explosion
  const rect = icon.getBoundingClientRect();
  const menuRect = menu.getBoundingClientRect();

  // Create multiple origins (e.g. 8 random ones inside .menu)
  const origins = Array.from({ length: 8 }, () => ({
    x: Math.random() * menuRect.width,
    y: Math.random() * menuRect.height,
  }));

  origins.forEach(origin => {
    for (let i = 0; i < 10; i++) { // 10 particles per origin = 80 total
      const particle = document.createElement('div');
      particle.className = 'explosion-particle';

      const angle = Math.random() * 2 * Math.PI;
      const radius = Math.random() * 100 + 30; // spread power
      const x = Math.cos(angle) * radius;
      const y = Math.sin(angle) * radius;

      particle.style.setProperty('--x', `${x}px`);
      particle.style.setProperty('--y', `${y}px`);
      particle.style.left = `${origin.x}px`;
      particle.style.top = `${origin.y}px`;

      explosionContainer.appendChild(particle);

      setTimeout(() => {
        particle.remove();
      }, 1000);
    }
  });


  // Cleanup
  setTimeout(() => {
    icon.classList.remove('animate');
    menu.classList.remove('shake');
    isAnimating = false;
  }, 1000);
});
